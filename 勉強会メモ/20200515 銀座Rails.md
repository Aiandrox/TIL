# 銀座Rails

## 標準仕様について

ABNF  
フォーマットを定義する

`DateTime.now.rfc3339`  
RFC3339  
https://tools.ietf.org/html/rfc3339

定義の仕方  
`〇〇 = なんちゃら "-" なんちゃら ":" なんちゃら`みたいな感じ  
どんどん展開していく

ABNFに沿っている≠標準仕様に従っている


## テストがないRailsプロジェクトにテストを足す話

- RubyとRailsのバージョンアップをしたい
- テストがないので足してほしい

**コードを憎んで人を憎まず**

action1000行ｗｗｗｗ

パッチサーバ  
stagingが動いているならバージョンアップして1月放置

webUI側  
これはテスト作ろうね、、、

### 自動テストの準備
  - simple_covの結果表示ができるもの  
  
### 進捗の見える化
  コメント「simple_cov から CodeCov に飛ばしてます。モチベーション上がる」

###  不要なコードの削除
  - Okuribito Rails
  - Ruby2.6以降ならoneshot coverageも使えそう
  
###  テストの追加の開始
  - modelに対するテストとか厳しいことが多い
  - 現状の仕様をテストに落とし込むことから
     - apiならrequest spec
     - UIならfeature spec
  - factory botの整備（特に時間がかかる）
    - associationが多段で複雑だったりすると大変
    - 理解が深いメンバーとペアプロするとスムーズ
  - 横展開
    - factory bot, CRUDのテストのサンプルが揃ってくる  
    →慣れていない人もコピペでもいいのでテストを書けるようになってくる


### 追加にかかる時間

simple_covのメソッド数やline数を、1〜2習慣で追加できたテストの数ではかって推測  
最初のほうが整備に時間がかかって大変なので後半は加速するはず

### テストがある程度できると……  
- バージョンアップが捗る
- リファクタリングがしやすくなる
  - modelへの切り分け、ユニットテストを書きやすいコード
- リリースの頻度UP



## Fat Model の倒し方

### 概要

肥大化したRailsアプリケーション（Fat Rails Application）のMVC構造において、  
最も辛くなりがちな層はViewでもControllerでもなくModelではないでしょうか。  
本発表ではFat Modelに立ち向かうためのアプローチを、  
1. Rails Way、2. Sub-Rails Way、3. Non-Rails Way  
の3つに分けて整理したいと考えています。

肥大化したRailsアプリケーション  
Fat Model >>> Fat Controller >> Fat View が辛い

習熟していくと
最後には
FatModelに
たどり着く

